<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title> Implementing a Backend Service in Rust — Part 1 | ar3s3ru — Danilo Cianfrone</title>
<meta name=description content="A collection of rants and silly thoughts, usually in Rust and Go (maybe Kotlin too).">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="all,follow">
<meta name=googlebot content="index,follow,snippet,archive">
<meta property="og:title" content="Implementing a Backend Service in Rust — Part 1">
<meta property="og:description" content="Project description, Package Structure and Repository setup">
<meta property="og:type" content="article">
<meta property="og:url" content="https://danilocianfrone.com/posts/2020-11-05-backend-service-in-rust-part-1/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2020-11-05T00:00:00+02:00">
<meta property="article:modified_time" content="2020-11-05T00:00:00+02:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Implementing a Backend Service in Rust — Part 1">
<meta name=twitter:description content="Project description, Package Structure and Repository setup">
<link rel=stylesheet href=https://danilocianfrone.com/css/style-classic.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]-->
<link rel=icon type=image/png href=https://danilocianfrone.com/images/favicon.ico>
</head>
<body class="max-width mx-auto px3 ltr">
<div class="content index py4">
<div id=header-post>
<a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast')" style=display:none><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu>
<span id=nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Posts</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/about>About</a></li>
</ul>
</span>
<br>
<span id=actions>
<ul>
<li>
<a class=icon href=https://danilocianfrone.com/about/>
<i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle()" onmouseout="$('#i-prev').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')">
<i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle()" onmouseout="$('#i-top').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=#>
<i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle()" onmouseout="$('#i-share').toggle()" onclick="return $('#share').toggle(),!1"></i>
</a>
</li>
</ul>
<span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span>
</span>
<br>
<div id=share style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fdanilocianfrone.com%2fposts%2f2020-11-05-backend-service-in-rust-part-1%2f">
<i class="fab fa-facebook" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=https%3a%2f%2fdanilocianfrone.com%2fposts%2f2020-11-05-backend-service-in-rust-part-1%2f&text=Implementing%20a%20Backend%20Service%20in%20Rust%20%e2%80%94%20Part%201">
<i class="fab fa-twitter" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fdanilocianfrone.com%2fposts%2f2020-11-05-backend-service-in-rust-part-1%2f&title=Implementing%20a%20Backend%20Service%20in%20Rust%20%e2%80%94%20Part%201">
<i class="fab fa-linkedin" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fdanilocianfrone.com%2fposts%2f2020-11-05-backend-service-in-rust-part-1%2f&is_video=false&description=Implementing%20a%20Backend%20Service%20in%20Rust%20%e2%80%94%20Part%201">
<i class="fab fa-pinterest" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=Implementing%20a%20Backend%20Service%20in%20Rust%20%e2%80%94%20Part%201&body=Check out this article: https%3a%2f%2fdanilocianfrone.com%2fposts%2f2020-11-05-backend-service-in-rust-part-1%2f">
<i class="fas fa-envelope" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fdanilocianfrone.com%2fposts%2f2020-11-05-backend-service-in-rust-part-1%2f&title=Implementing%20a%20Backend%20Service%20in%20Rust%20%e2%80%94%20Part%201">
<i class="fab fa-get-pocket" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fdanilocianfrone.com%2fposts%2f2020-11-05-backend-service-in-rust-part-1%2f&title=Implementing%20a%20Backend%20Service%20in%20Rust%20%e2%80%94%20Part%201">
<i class="fab fa-reddit" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fdanilocianfrone.com%2fposts%2f2020-11-05-backend-service-in-rust-part-1%2f&title=Implementing%20a%20Backend%20Service%20in%20Rust%20%e2%80%94%20Part%201">
<i class="fab fa-stumbleupon" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://digg.com/submit?url=https%3a%2f%2fdanilocianfrone.com%2fposts%2f2020-11-05-backend-service-in-rust-part-1%2f&title=Implementing%20a%20Backend%20Service%20in%20Rust%20%e2%80%94%20Part%201">
<i class="fab fa-digg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fdanilocianfrone.com%2fposts%2f2020-11-05-backend-service-in-rust-part-1%2f&name=Implementing%20a%20Backend%20Service%20in%20Rust%20%e2%80%94%20Part%201&description=Project%20description%2c%20Package%20Structure%20and%20Repository%20setup">
<i class="fab fa-tumblr" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fdanilocianfrone.com%2fposts%2f2020-11-05-backend-service-in-rust-part-1%2f&t=Implementing%20a%20Backend%20Service%20in%20Rust%20%e2%80%94%20Part%201">
<i class="fab fa-hacker-news" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=toc>
<nav id=TableOfContents>
<ul>
<li><a href=#_dumbbit_-a-_dumb_-reddit-clone><em>Dumbbit</em>: A <em>dumb</em> Reddit clone</a></li>
<li><a href=#repository-setup>Repository Setup</a>
<ul>
<li><a href=#create-a-new-crate>Create a new crate</a>
<ul>
<li><a href=#why-not-virtual-workspaces>Why not virtual workspaces?</a></li>
</ul>
</li>
<li><a href=#set-up-a-continuous-integration-pipeline>Set up a Continuous Integration pipeline</a></li>
<li><a href=#our-first-_dumb_-http-server>Our first <em>Dumb</em> HTTP Server</a></li>
</ul>
</li>
<li><a href=#whats-next>What&rsquo;s next?</a></li>
</ul>
</nav>
</div>
</span>
</div>
<article class=post itemscope itemtype=http://schema.org/BlogPosting>
<header>
<h1 class=posttitle itemprop="name headline">
Implementing a Backend Service in Rust — Part 1
</h1>
<div class=meta>
<div class=postdate>
<time datetime="2020-11-05 00:00:00 +0200 +0200" itemprop=datePublished>2020-11-05</time>
</div>
<div class=article-tag>
<i class="fas fa-tag"></i>
<a class=tag-link href=/tags/rust rel=tag>rust</a>
<a class=tag-link href=/tags/backend rel=tag>backend</a>
</div>
</div>
</header>
<div class=content itemprop=articleBody>
<p>I&rsquo;ve been using Rust for quite a while now.</p>
<p>Most notably, I&rsquo;ve been involved in the development of <a href=https://github.com/ar3s3ru/eventually-rs><code>eventually-rs</code></a>,
a Rust crate providing support for Event-sourced applications.</p>
<p>My background has to do with Systems Programming and Backend Development,
which was the main drive for creating <code>eventually</code>.</p>
<p>In the process of writing the crate, I&rsquo;ve been reimplementing a couple of those
microservices I was currently working on on my daily job, as a sort of
testing project to validate the soundness of the crate and its design decisions.</p>
<p>During this time, I&rsquo;ve gradually learned how to implement much of the features
a service <em>needs</em> for <em>production-readiness</em>, in the Rust ecosystem, such as:
<strong>instrumentation</strong>, <strong>distributed tracing</strong>, <strong>package structure</strong>,
<strong>containerization</strong> and so on.</p>
<p>With this series, I aim to lay those concepts down for you,
whether you may or may not be familiar with them already, and apply them using
<strong>stable Rust</strong>.</p>
<p>By the end of the series, we should have a <em>(almost)</em> <strong>production-ready</strong>
Rust service, ready to be deployed somewhere in the cloud.</p>
<p>But&mldr; before jumping into the code, let&rsquo;s talk about what we are going
to build.</p>
<h2 id=_dumbbit_-a-_dumb_-reddit-clone><em>Dumbbit</em>: A <em>dumb</em> Reddit clone</h2>
<p>Well, the title says it all&mldr;</p>
<p>For personal projects, I usually draw inspirations from things I use a lot.
As a matter of fact, I&rsquo;m pretty active on Reddit, so why not trying
to recreate a very small MVP of Reddit?</p>
<p>This is what we&rsquo;re going to implement in the service:</p>
<ul>
<li><strong>Topics</strong> (i.e. <em>Subreddits</em>)
<ul>
<li><strong>Create</strong> a new Topic</li>
<li><strong>Visualize</strong> a Topic</li>
</ul>
</li>
<li><strong>Homepage</strong>
<ul>
<li><strong>Follow</strong> a Topic</li>
<li><strong>Display</strong> new <strong>Posts</strong> from followed Topics</li>
</ul>
</li>
<li><strong>Posts</strong>
<ul>
<li><strong>Create</strong> a Post in a Topic</li>
<li><strong>Upvote</strong> or <strong>Downvote</strong> a Post</li>
</ul>
</li>
</ul>
<p>We can keep things <em>fairly</em> small, while still have enough content
to cover much of the many aspects you might find in your typical service
development endeavors.</p>
<p>Now that we know what we&rsquo;re going to build, let&rsquo;s talk about how to set up
the repository that is going to host our code!</p>
<h2 id=repository-setup>Repository Setup</h2>
<p>This might probably be the least favorite part of the development cycle for many people.
However, I find it of great importance to get it right, just as much as the actual code
we&rsquo;re going to write: it will help us write code that actually matters, faster.</p>
<p>In this section, we&rsquo;re going to discuss: package structure, Continuous Integration
pipeline, etc.</p>
<h3 id=create-a-new-crate>Create a new crate</h3>
<p>Let&rsquo;s use <code>cargo</code> to create the new crate:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>cargo new --lib dumbbit
</code></pre></div><p>This will create a <em>library crate</em>, which means the first and only Rust
source code file will be in <code>src/lib.rs</code>.</p>
<p>I personally prefer having the main crate as a library, and add as many
binaries as artifacts needed under <code>src/bin</code>. In our case, let&rsquo;s create
an initial <code>dumbbit.rs</code> file in <code>src/bin</code> with a simple <code>"Hello World"</code>:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#d14>//! src/bin/dumbbit.rs
</span><span style=color:#d14></span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#000;font-weight:700>fn</span> <span style=color:#900;font-weight:700>main</span>()<span style=color:#bbb> </span>{<span style=color:#bbb>
</span><span style=color:#bbb>    </span>println<span style=color:#000;font-weight:700>!</span>(<span style=color:#d14>&#34;Hello World!&#34;</span>)<span style=color:#bbb>
</span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></code></pre></div><p>If we run <code>cargo run</code> we should get the following output:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ cargo run
Hello World!
</code></pre></div><h4 id=why-not-virtual-workspaces>Why not virtual workspaces?</h4>
<p>A <a href=https://doc.rust-lang.org/book/ch14-03-cargo-workspaces.html>Cargo Workspace</a> allows to package multiple crates
in the same repository space, by sharing a single <code>Cargo.lock</code> instead
of one per each crate member.</p>
<p>There are some notable examples of workspaces, such as <a href=https://github.com/rust-lang/futures-rs><code>futures-rs</code></a>.</p>
<p>A valid package structure idea might be to split multiple layers of the
service application onto separate crates. This has the following advantages:</p>
<ol>
<li>Incremental compilation for the updated crates</li>
<li><strong>Concurrent</strong> crate compilation from Cargo during <code>cargo run</code> or <code>cargo build</code></li>
<li>Flat and tidy package structure</li>
</ol>
<p>However, this makes things a bit <strong>more complicated</strong> with Docker images, and for most
cases there are no concrete benefits of using such structure (unless, of course, your
application has a high number of modules and dependencies).</p>
<p><em>Suggestion:</em> start with a single crate, split layers using modules and <strong>if</strong>
the number of modules reaches a &ldquo;big enough&rdquo; number, you can:</p>
<ol>
<li>Move the modules from <code>src/</code> to the root level,</li>
<li>Add a <code>Cargo.toml</code> for each module to the root level,</li>
<li>Change the <code>Cargo.toml</code> in the root level to a <a href=https://doc.rust-lang.org/book/ch14-03-cargo-workspaces.html>Cargo Workspace</a> one</li>
<li>Import crates as needed</li>
</ol>
<h3 id=set-up-a-continuous-integration-pipeline>Set up a Continuous Integration pipeline</h3>
<p>Continuing on setting up the development environment, next thing we gotta do
is to set up a <em>Continuous Integration pipeline</em>.</p>
<p>At the very least, the CI should perform the following checks:</p>
<ul>
<li>Check that the code compiles successfully</li>
<li>Run all kinds of testing suites</li>
<li>Make sure the code conforms to our styleguides using a Linter</li>
</ul>
<p>There might be additional steps you want to include in your CI pipeline (e.g. generating
documentation), but for now this should be enough.</p>
<p>You can use whatever tool you like the most, but in our case, since the code
is going to be hosted in Github, we&rsquo;re going to use Github Actions.</p>
<p>Luckily, there are a number of very useful Actions already out there
for Rust, such as:</p>
<ul>
<li><a href=https://github.com/actions-rs/toolchain>actions-rs/toolchain</a>, to target a specific Rust version</li>
<li><a href=https://github.com/actions-rs/tarpaulin>actions-rs/tarpaulin</a>, to use <code>cargo-tarpaulin</code> for running tests and collect coverage profiles</li>
<li><a href=https://github.com/actions-rs/clippy-check>actions-rs/clippy-check</a>, to run the Clippy linter</li>
</ul>
<p>In our particular case, we can use the following Workflow configuration
to enable testing with coverage, compilation and linting,
by adding this file to <code>.github/workflows</code>:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:navy>name</span>:<span style=color:#bbb> </span>Rust (stable)<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:navy>on</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:navy>pull_request</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:navy>push</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:navy>branches</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- master<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:navy>jobs</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#998;font-style:italic># Make sure the project compiles, without trying to building the whole project.</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:navy>check</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:navy>name</span>:<span style=color:#bbb> </span>Check<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:navy>runs-on</span>:<span style=color:#bbb> </span>ubuntu-latest<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:navy>steps</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:navy>name</span>:<span style=color:#bbb> </span>Checkout sources<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:navy>uses</span>:<span style=color:#bbb> </span>actions/checkout@v2.3.3<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:navy>name</span>:<span style=color:#bbb> </span>Install stable toolchain<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:navy>uses</span>:<span style=color:#bbb> </span>actions-rs/toolchain@v1<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:navy>with</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:navy>profile</span>:<span style=color:#bbb> </span>minimal<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:navy>toolchain</span>:<span style=color:#bbb> </span>stable<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:navy>override</span>:<span style=color:#bbb> </span><span style=color:#000;font-weight:700>true</span><span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:navy>name</span>:<span style=color:#bbb> </span>Run cargo check<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:navy>uses</span>:<span style=color:#bbb> </span>actions-rs/cargo@v1<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:navy>with</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:navy>command</span>:<span style=color:#bbb> </span>check<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#998;font-style:italic># Run unit and integration tests in the project.</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#998;font-style:italic># Using tarpaulin to collect coverage reports and upload to Codecov (requires token).</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:navy>tests</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:navy>name</span>:<span style=color:#bbb> </span>Test Suite<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:navy>runs-on</span>:<span style=color:#bbb> </span>ubuntu-latest<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:navy>steps</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:navy>name</span>:<span style=color:#bbb> </span>Checkout repository<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:navy>uses</span>:<span style=color:#bbb> </span>actions/checkout@v2.3.3<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:navy>name</span>:<span style=color:#bbb> </span>Install stable toolchain<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:navy>uses</span>:<span style=color:#bbb> </span>actions-rs/toolchain@v1<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:navy>with</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:navy>toolchain</span>:<span style=color:#bbb> </span>stable<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:navy>override</span>:<span style=color:#bbb> </span><span style=color:#000;font-weight:700>true</span><span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:navy>name</span>:<span style=color:#bbb> </span>Run cargo-tarpaulin (main)<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:navy>uses</span>:<span style=color:#bbb> </span>actions-rs/tarpaulin@v0.1<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:navy>name</span>:<span style=color:#bbb> </span>Upload to codecov.io<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:navy>uses</span>:<span style=color:#bbb> </span>codecov/codecov-action@v1.0.14<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:navy>with</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:navy>token</span>:<span style=color:#bbb> </span>${{secrets.CODECOV_TOKEN}}<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:navy>flags</span>:<span style=color:#bbb> </span>unit<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:navy>name</span>:<span style=color:#bbb> </span>Archive code coverage results<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:navy>uses</span>:<span style=color:#bbb> </span>actions/upload-artifact@v2.2.0<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:navy>with</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:navy>name</span>:<span style=color:#bbb> </span>code-coverage-report<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:navy>path</span>:<span style=color:#bbb> </span>cobertura.xml<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#998;font-style:italic># Run cargofmt and clippy to highlight warnings and style errors.</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:navy>lints</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:navy>name</span>:<span style=color:#bbb> </span>Lints<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:navy>runs-on</span>:<span style=color:#bbb> </span>ubuntu-latest<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:navy>steps</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:navy>name</span>:<span style=color:#bbb> </span>Checkout sources<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:navy>uses</span>:<span style=color:#bbb> </span>actions/checkout@v2.3.3<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:navy>name</span>:<span style=color:#bbb> </span>Install stable toolchain<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:navy>uses</span>:<span style=color:#bbb> </span>actions-rs/toolchain@v1<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:navy>with</span>:<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:navy>profile</span>:<span style=color:#bbb> </span>minimal<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:navy>toolchain</span>:<span style=color:#bbb> </span>stable<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:navy>override</span>:<span style=color:#bbb> </span><span style=color:#000;font-weight:700>true</span><span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:navy>components</span>:<span style=color:#bbb> </span>rustfmt, clippy<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:navy>name</span>:<span style=color:#bbb> </span>Run cargo fmt<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:navy>uses</span>:<span style=color:#bbb> </span>actions-rs/cargo@v1<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:navy>with</span>:<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:navy>command</span>:<span style=color:#bbb> </span>fmt<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:navy>args</span>:<span style=color:#bbb> </span>--all -- --check<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>        </span>- <span style=color:navy>name</span>:<span style=color:#bbb> </span>Run cargo clippy<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:navy>uses</span>:<span style=color:#bbb> </span>actions-rs/clippy-check@v1<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:navy>with</span>:<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:navy>token</span>:<span style=color:#bbb> </span>${{ secrets.GITHUB_TOKEN }}<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:navy>args</span>:<span style=color:#bbb> </span>--all-features<span style=color:#bbb>
</span></code></pre></div><p>This pipeline will work whether we push directly to <code>master</code>, or we open
a Pull Request.</p>
<h3 id=our-first-_dumb_-http-server>Our first <em>Dumb</em> HTTP Server</h3>
<p>The application transport choice for now is HTTP.</p>
<p>Then, let&rsquo;s create a simple <em>&ldquo;Hello World&rdquo;</em> application for now!</p>
<p>Remember: we want this application to run on <code>stable</code> so&mldr; no <a href=https://github.com/SergioBenitez/Rocket>Rocket</a>.
However, a nice <code>stable</code>-compatible HTTP library we can use is <a href=https://github.com/http-rs/tide><code>tide</code></a>.</p>
<p>Let&rsquo;s add the dependency in <code>Cargo.toml</code> like so:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml>[dependencies]
tide = <span style=color:#d14>&#34;0.14.0&#34;</span>
</code></pre></div><p>To use <a href=https://github.com/http-rs/tide><code>tide</code></a> however, we need the <a href=https://github.com/async-rs/async-std><code>async-std</code></a> executor to
be able to run Futures in the <code>main()</code> entrypoint. Let&rsquo;s add it to the project:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml>[dependencies]
async-std = { version = <span style=color:#d14>&#34;1.7.0&#34;</span>, features = [<span style=color:#d14>&#34;attributes&#34;</span>] }
</code></pre></div><p>Last but not least, I&rsquo;m a <em>huge</em> fan of <a href=https://github.com/dtolnay/anyhow><code>anyhow</code></a> for generic errors,
since I don&rsquo;t particularly like the <code>Box&lt;dyn std::error::Error></code> notation.
Let&rsquo;s add that one in <code>Cargo.toml</code> too:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml>[dependencies]
anyhow = <span style=color:#d14>&#34;1.0&#34;</span>
</code></pre></div><p>With the new dependencies, we can put the new HTTP server code in <code>src/bin/dumbbit.rs</code>.
The file should look like this:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#999;font-weight:700;font-style:italic>#[async_std::main]</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#000;font-weight:700>async</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>fn</span> <span style=color:#900;font-weight:700>main</span>()<span style=color:#bbb> </span>-&gt; <span style=color:#458;font-weight:700>anyhow</span>::<span style=color:#0086b3>Result</span><span style=color:#000;font-weight:700>&lt;</span>()<span style=color:#000;font-weight:700>&gt;</span><span style=color:#bbb> </span>{<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>let</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>mut</span><span style=color:#bbb> </span>app<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>tide::new();<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span>app.at(<span style=color:#d14>&#34;/&#34;</span>).get(<span style=color:#000;font-weight:700>|</span>_<span style=color:#000;font-weight:700>|</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>async</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>move</span><span style=color:#bbb> </span>{<span style=color:#bbb> </span><span style=color:#0086b3>Ok</span>(<span style=color:#d14>&#34;Hello, world!\n&#34;</span>)<span style=color:#bbb> </span>});<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#0086b3>Ok</span>(app.listen(<span style=color:#d14>&#34;0.0.0.0:8080&#34;</span>).<span style=color:#000;font-weight:700>await</span><span style=color:#000;font-weight:700>?</span>)<span style=color:#bbb>
</span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></code></pre></div><p>As you can probably tell, the HTTP server is listening to incoming connections
on the port <code>8080</code>. <code>tide::new()</code> creates a new router, and the <code>at("/").get(..)</code>
means that every <code>GET http://localhost:8080/</code> requests will get <code>Hello, world!</code>
in response.</p>
<p>Pretty neat, huh?</p>
<p><code>async_std::main</code> is a macro that runs the <code>async fn main()</code> onto the <code>async_std</code>
executor (if you don&rsquo;t know what an executor is, <a href=https://rust-lang.github.io/async-book/02_execution/05_io.html>you can check this link</a>).</p>
<p>We can run the application using <code>cargo run</code>.</p>
<p>Let&rsquo;s test it out with <code>curl</code>:</p>
<pre tabindex=0><code>curl http://localhost:8080/ -v
*   Trying ::1:8080...
* connect to ::1 port 8080 failed: Connection refused
*   Trying 127.0.0.1:8080...
* Connected to localhost (127.0.0.1) port 8080 (#0)
&gt; GET / HTTP/1.1
&gt; Host: localhost:8080
&gt; User-Agent: curl/7.72.0
&gt; Accept: */*
&gt;
* Mark bundle as not supporting multiuse
&lt; HTTP/1.1 200 OK
&lt; content-length: 14
&lt; date: Wed, 04 Nov 2020 23:12:40 GMT
&lt; content-type: text/plain;charset=utf-8
&lt;
Hello, world!
* Connection #0 to host localhost left intact
</code></pre><p>🎉 <strong>It works!</strong> 🎉</p>
<p>We have now a pretty decent HTTP server. Bet it can also handle quite a high traffic 😛</p>
<h2 id=whats-next>What&rsquo;s next?</h2>
<p>Now that we have a functioning HTTP server, the next tasks are:</p>
<ol>
<li>Implementing the <strong>domain layer</strong></li>
<li>Implementing the <strong>infrastructure layer</strong> (e.g. database connections, HTTP API, etc.)</li>
<li>Package the application in a <strong>Docker image</strong></li>
<li><strong>Deploy it</strong> somewhere!</li>
</ol>
<p>In the next blog post, we&rsquo;re going to tackle the Domain implementation. We&rsquo;ll start with
some light domain modeling using <strong>Event Storming</strong>, and how that would translate into
our Rust code. You&rsquo;ll find out, Rust&rsquo;s type system allows for <em>very expressive</em>, and
<strong>safe</strong>, domain modeling.</p>
<p>For now, you&rsquo;ll find the Dumbbit code explained in this blog post so far in this repository, at the <code>blog-post-part-1</code> label: <a href=https://github.com/ar3s3ru/dumbbit/tree/blog-post-part-1>https://github.com/ar3s3ru/dumbbit/tree/blog-post-part-1</a></p>
<p>Let me know what you think!</p>
<p>You can reach out to me on Github, or my <a href=mailto:danilocianfr+blog@gmail.com>email account</a>. You can find me on
Twitter or LinkedIn, all the places!</p>
</div>
</article>
<div id=footer-post-container>
<div id=footer-post>
<div id=nav-footer style=display:none>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Posts</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/about>About</a></li>
</ul>
</div>
<div id=toc-footer style=display:none>
<nav id=TableOfContents>
<ul>
<li><a href=#_dumbbit_-a-_dumb_-reddit-clone><em>Dumbbit</em>: A <em>dumb</em> Reddit clone</a></li>
<li><a href=#repository-setup>Repository Setup</a>
<ul>
<li><a href=#create-a-new-crate>Create a new crate</a>
<ul>
<li><a href=#why-not-virtual-workspaces>Why not virtual workspaces?</a></li>
</ul>
</li>
<li><a href=#set-up-a-continuous-integration-pipeline>Set up a Continuous Integration pipeline</a></li>
<li><a href=#our-first-_dumb_-http-server>Our first <em>Dumb</em> HTTP Server</a></li>
</ul>
</li>
<li><a href=#whats-next>What&rsquo;s next?</a></li>
</ul>
</nav>
</div>
<div id=share-footer style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fdanilocianfrone.com%2fposts%2f2020-11-05-backend-service-in-rust-part-1%2f">
<i class="fab fa-facebook fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=https%3a%2f%2fdanilocianfrone.com%2fposts%2f2020-11-05-backend-service-in-rust-part-1%2f&text=Implementing%20a%20Backend%20Service%20in%20Rust%20%e2%80%94%20Part%201">
<i class="fab fa-twitter fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fdanilocianfrone.com%2fposts%2f2020-11-05-backend-service-in-rust-part-1%2f&title=Implementing%20a%20Backend%20Service%20in%20Rust%20%e2%80%94%20Part%201">
<i class="fab fa-linkedin fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fdanilocianfrone.com%2fposts%2f2020-11-05-backend-service-in-rust-part-1%2f&is_video=false&description=Implementing%20a%20Backend%20Service%20in%20Rust%20%e2%80%94%20Part%201">
<i class="fab fa-pinterest fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=Implementing%20a%20Backend%20Service%20in%20Rust%20%e2%80%94%20Part%201&body=Check out this article: https%3a%2f%2fdanilocianfrone.com%2fposts%2f2020-11-05-backend-service-in-rust-part-1%2f">
<i class="fas fa-envelope fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fdanilocianfrone.com%2fposts%2f2020-11-05-backend-service-in-rust-part-1%2f&title=Implementing%20a%20Backend%20Service%20in%20Rust%20%e2%80%94%20Part%201">
<i class="fab fa-get-pocket fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fdanilocianfrone.com%2fposts%2f2020-11-05-backend-service-in-rust-part-1%2f&title=Implementing%20a%20Backend%20Service%20in%20Rust%20%e2%80%94%20Part%201">
<i class="fab fa-reddit fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fdanilocianfrone.com%2fposts%2f2020-11-05-backend-service-in-rust-part-1%2f&title=Implementing%20a%20Backend%20Service%20in%20Rust%20%e2%80%94%20Part%201">
<i class="fab fa-stumbleupon fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://digg.com/submit?url=https%3a%2f%2fdanilocianfrone.com%2fposts%2f2020-11-05-backend-service-in-rust-part-1%2f&title=Implementing%20a%20Backend%20Service%20in%20Rust%20%e2%80%94%20Part%201">
<i class="fab fa-digg fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fdanilocianfrone.com%2fposts%2f2020-11-05-backend-service-in-rust-part-1%2f&name=Implementing%20a%20Backend%20Service%20in%20Rust%20%e2%80%94%20Part%201&description=Project%20description%2c%20Package%20Structure%20and%20Repository%20setup">
<i class="fab fa-tumblr fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fdanilocianfrone.com%2fposts%2f2020-11-05-backend-service-in-rust-part-1%2f&t=Implementing%20a%20Backend%20Service%20in%20Rust%20%e2%80%94%20Part%201">
<i class="fab fa-hacker-news fa-lg" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=actions-footer>
<a id=menu class=icon href=# onclick="return $('#nav-footer').toggle(),!1">
<i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc class=icon href=# onclick="return $('#toc-footer').toggle(),!1">
<i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share class=icon href=# onclick="return $('#share-footer').toggle(),!1">
<i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')">
<i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a>
</div>
</div>
</div>
<footer id=footer>
<div class=footer-left>
Copyright &copy; 2021 ar3s3ru — Danilo Cianfrone
</div>
<div class=footer-right>
<nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Posts</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/about>About</a></li>
</ul>
</nav>
</div>
</footer>
</div>
</body>
<link rel=stylesheet href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
</html>